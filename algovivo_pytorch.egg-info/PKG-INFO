Metadata-Version: 2.4
Name: algovivo-pytorch
Version: 0.1.0
Summary: PyTorch reimplementation of the algovivo energy-based simulation system
Author: Algovivo PyTorch Contributors
License-Expression: MIT
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Science/Research
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Scientific/Engineering
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: torch>=2.0.0
Requires-Dist: numpy>=1.20.0
Requires-Dist: matplotlib>=3.5.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=4.0.0; extra == "dev"

# Algovivo PyTorch Implementation

This is a PyTorch reimplementation of the algovivo energy-based simulation system.

## Structure

- `algovivo_pytorch/energy.py`: Six energy functions (Gravity, Collision, Triangles/Neo-Hookean, Muscles, Friction, Inertia)
- `algovivo_pytorch/system.py`: System class managing simulation state and backward Euler optimization
- `algovivo_pytorch/policy.py`: NeuralFramePolicy for controlling muscles
- `test_trajectory.py`: Test script that replicates the trajectory test from the original repo
- `create_custom_robot.py`: Script for creating robots with different topologies (simple, quadruped, snake, star)
- `visualize_random_robot.py`: Script for generating and visualizing random robot topologies

## Status

The implementation is functional and runs the simulation correctly. After fixing the default parameters to match the original (k_collision=14000, k_friction=300, k_muscle=90), the trajectory test shows small differences from the reference:

- Position errors: ~0.008-0.044 (very small, < 2% of typical positions)
- Velocity errors: ~0.25-1.34 (small relative to velocities)

These differences are expected and likely due to:
1. Numerical precision differences between C++ float32 and PyTorch float32 operations
2. Optimization convergence differences (different iteration paths)
3. Small floating-point accumulation differences

The core algorithms are implemented correctly:
- All six energy functions match the original C++ implementations
- Backward Euler optimization loop with gradient descent and line search
- Neural frame policy for muscle control

**Visual verification**: A video has been generated (`simulation.mp4`) showing the biped creature walking, confirming the simulation works correctly.

## Installation

### As a Package (Recommended)

Install the package in editable mode for development:

```bash
pip install -e .
```

Or install from a git repository:

```bash
pip install git+https://github.com/schenkmanjack/alife_bots.git
```

### Development Setup

```bash
# Clone the repository
git clone <repository-url>
cd alife_bots

# Install in editable mode with dependencies
pip install -e .

# Or install dependencies separately
pip install -r requirements.txt
```

## Using in Another Repository

This package can be installed and used as a dependency in other Python projects.

### Installation Options

**Option 1: Install from GitHub (For Using the Package)**

This installs a read-only copy of the package. You can use it, but **cannot push changes** back to the repository.

Add to your project's `requirements.txt`:
```
algovivo-pytorch @ git+https://github.com/schenkmanjack/alife_bots.git
```

Or install directly:
```bash
pip install git+https://github.com/schenkmanjack/alife_bots.git
```

**Option 2: Clone for Development (For Making Changes)**

If you want to **make changes and push them**, you need to clone the repository first:

```bash
# Clone the repository
git clone https://github.com/schenkmanjack/alife_bots.git
cd alife_bots

# Install in editable mode (changes to code are immediately available)
pip install -e .

# Make your changes, then push
git add .
git commit -m "Your changes"
git push
```

**Option 3: Install from Local Directory (For Local Development)**

If you have both repositories locally (e.g., `alife_bots` and `EvoAI` in the same parent directory), you can install `alife_bots` in your other project's environment:

**For Conda Environments (like EvoAI):**

```bash
# Activate your conda environment (e.g., evoai)
conda activate evoai

# Install alife_bots in editable mode from the local path
pip install -e /home/ubuntu/alife_bots

# Or use a relative path if both repos are in the same directory
pip install -e ../alife_bots
```

**Add to EvoAI's `requirements.txt`:**
```
-e /home/ubuntu/alife_bots
# Or use relative path:
# -e ../alife_bots
```

**Add to EvoAI's `environment.yml` (under pip section):**
```yaml
  - pip:
    - -e /home/ubuntu/alife_bots
    # Or use relative path:
    # - -e ../alife_bots
```

> **Important:** You **must** install `alife_bots` in the EvoAI conda environment for EvoAI to be able to import and use it. Simply having both repositories on your filesystem is not enough - Python needs the package to be installed in the environment where you're running your code.

**Option 4: Install from Built Wheel**

If you have a built wheel file:
```bash
pip install algovivo_pytorch-0.1.0-py3-none-any.whl
```

> **Note:** Installing via `pip install git+...` downloads and installs the package, but it's not a git repository you can push to. To make changes and push them, you must clone the repository first (Option 2).

### Usage Example

Once installed, you can import and use the package in your code:

```python
from algovivo_pytorch import System, NeuralFramePolicy
from algovivo_pytorch import (
    gravity_energy,
    collision_energy,
    triangle_energy,
    muscle_energy,
    friction_energy,
    inertia_energy,
    backward_euler_loss
)

# Create a simulation system
system = System(
    space_dim=2,
    h=0.033,
    k_collision=14000.0,
    k_friction=300.0,
    k_muscle=90.0,
    device='cpu'
)

# Set up your mesh and muscles
system.set(pos, triangles, muscles=muscles, ...)

# Create a policy for muscle control
policy = NeuralFramePolicy(input_dim=4, hidden_dims=[64, 64], output_dim=2)

# Run simulation steps
for step in range(num_steps):
    # Get muscle actions from policy
    actions = policy(observations)
    
    # Step the simulation
    system.step(actions)
    
    # Access current state
    positions = system.pos
    velocities = system.vel
```

### Adding to Your Project's Dependencies

**For projects using `pyproject.toml`:**
```toml
[project]
dependencies = [
    "algovivo-pytorch @ git+https://github.com/schenkmanjack/alife_bots.git",
    # ... other dependencies
]
```

**For projects using `setup.py`:**
```python
install_requires=[
    "algovivo-pytorch @ git+https://github.com/schenkmanjack/alife_bots.git",
    # ... other dependencies
]
```

**For projects using `requirements.txt`:**
```
algovivo-pytorch @ git+https://github.com/schenkmanjack/alife_bots.git
```

**For projects using Conda (`environment.yml`):**
```yaml
dependencies:
  - pip
  - pip:
    - algovivo-pytorch @ git+https://github.com/schenkmanjack/alife_bots.git
```

### Example: Using with EvoAI

If you have both `alife_bots` and `EvoAI` repositories locally:

1. **Activate the EvoAI conda environment:**
   ```bash
   conda activate evoai
   ```

2. **Install alife_bots in editable mode:**
   ```bash
   pip install -e /home/ubuntu/alife_bots
   ```

3. **Use in your EvoAI code:**
   ```python
   # In any EvoAI Python file
   from algovivo_pytorch import System, NeuralFramePolicy
   
   # Create and use the simulation system
   system = System(space_dim=2, h=0.033)
   # ... rest of your code
   ```

4. **Optional: Add to EvoAI's `requirements.txt` or `environment.yml`** so others can install it automatically:
   - Add `-e /home/ubuntu/alife_bots` to `requirements.txt`
   - Or add it to the `pip:` section in `environment.yml`

## Running

```bash
# Run trajectory test
python test_trajectory.py

# Debug first step
python debug_step0.py

# Generate video visualization
python generate_video.py --steps 100 --fps 30

# Create custom robot topologies
python create_custom_robot.py

# Generate and visualize random robots
python visualize_random_robot.py
```

## Files

- `algovivo_pytorch/`: Main implementation
  - `energy.py`: Six energy functions
  - `system.py`: System class and optimization loop
  - `policy.py`: NeuralFramePolicy
- `test_trajectory.py`: Trajectory replication test
- `generate_video.py`: Video visualization generator (uses mesh/policy from algovivo.repo)
- `create_custom_robot.py`: Create robots with predefined topologies
- `visualize_random_robot.py`: Generate and visualize random robot topologies
- `debug_step0.py`: Debug script for first simulation step
- Output files: Various `.mp4` videos and `.png` images from simulations

## Investigation Results

After investigation, the main issue was incorrect default parameters:
- Fixed: k_collision from 100 → 14000
- Fixed: k_friction from 100 → 300  
- Fixed: k_muscle from 1000 → 90

After these fixes, the simulation matches the reference very closely. Remaining small differences are expected due to numerical precision differences between C++ and PyTorch.
